<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üèõÔ∏è Cline v10 Multi-Judge Tribunal</title>
  <link rel="stylesheet" href="/arcade/style.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0a0a0a;
      color: #00ff88;
      font-family: 'Courier New', monospace;
      padding: 20px;
      position: relative;
    }

    /* CRT Scanlines */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        transparent 50%,
        rgba(0, 0, 0, 0.3) 50%
      );
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 9999;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 0 0 10px rgba(0, 255, 136, 0.8);
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .header p {
      color: #00ffe1;
      font-size: 1.1em;
    }

    .judges-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .judge-card {
      background: rgba(0, 255, 136, 0.05);
      border: 2px solid #00ff88;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
    }

    .judge-card.offline {
      border-color: #666;
      opacity: 0.5;
    }

    .judge-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .judge-name {
      font-size: 1.3em;
      font-weight: bold;
    }

    .judge-status {
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 0.9em;
    }

    .judge-status.online {
      background: #00ff88;
      color: #0a0a0a;
    }

    .judge-status.offline {
      background: #666;
      color: #ccc;
    }

    .judge-stats {
      margin-top: 10px;
      font-size: 0.95em;
      line-height: 1.6;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
    }

    .task-panel {
      background: rgba(0, 255, 225, 0.05);
      border: 2px solid #00ffe1;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 30px;
    }

    .task-panel h2 {
      color: #00ffe1;
      margin-bottom: 15px;
      font-size: 1.5em;
    }

    .task-form {
      display: grid;
      gap: 15px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      color: #00ffe1;
      font-weight: bold;
    }

    select, textarea, input {
      background: #0a0a0a;
      border: 1px solid #00ff88;
      border-radius: 4px;
      color: #00ff88;
      padding: 10px;
      font-family: 'Courier New', monospace;
      font-size: 1em;
    }

    textarea {
      min-height: 150px;
      resize: vertical;
    }

    button {
      background: #00ff88;
      color: #0a0a0a;
      border: none;
      padding: 12px 24px;
      font-size: 1.1em;
      font-weight: bold;
      border-radius: 4px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
      transition: all 0.3s;
    }

    button:hover {
      background: #00ffe1;
      box-shadow: 0 0 25px rgba(0, 255, 225, 0.7);
    }

    button:disabled {
      background: #666;
      cursor: not-allowed;
      box-shadow: none;
    }

    .results-panel {
      background: rgba(0, 255, 136, 0.05);
      border: 2px solid #00ff88;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 30px;
      display: none;
    }

    .results-panel.active {
      display: block;
    }

    .results-panel h2 {
      margin-bottom: 20px;
      font-size: 1.8em;
    }

    .consensus-result {
      background: rgba(0, 255, 225, 0.1);
      border: 2px solid #00ffe1;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .verdict {
      font-size: 2em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .verdict.positive {
      color: #00ff88;
    }

    .verdict.warning {
      color: #ffaa00;
    }

    .verdict.critical {
      color: #ff0066;
    }

    .confidence-bar {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid #00ff88;
      border-radius: 4px;
      height: 30px;
      overflow: hidden;
      margin: 10px 0;
    }

    .confidence-fill {
      background: linear-gradient(90deg, #00ff88, #00ffe1);
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #0a0a0a;
      transition: width 1s ease;
    }

    .votes-list {
      margin-top: 20px;
    }

    .vote-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #00ff88;
      border-radius: 6px;
      padding: 15px;
      margin: 10px 0;
    }

    .vote-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .vote-verdict {
      font-size: 1.2em;
      font-weight: bold;
    }

    .vote-confidence {
      color: #00ffe1;
    }

    .disagreement-warning {
      background: rgba(255, 0, 102, 0.1);
      border: 2px solid #ff0066;
      border-radius: 6px;
      padding: 15px;
      margin: 15px 0;
      color: #ff0066;
      font-weight: bold;
    }

    .stats-panel {
      background: rgba(0, 255, 136, 0.05);
      border: 2px solid #00ff88;
      border-radius: 8px;
      padding: 25px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .stat-card {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #00ffe1;
      border-radius: 6px;
      padding: 15px;
    }

    .stat-value {
      font-size: 2em;
      color: #00ffe1;
      font-weight: bold;
    }

    .stat-label {
      font-size: 0.9em;
      margin-top: 5px;
    }

    .loading {
      text-align: center;
      padding: 20px;
      font-size: 1.2em;
      color: #00ffe1;
    }

    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üèõÔ∏è CLINE V10 MULTI-JUDGE TRIBUNAL</h1>
    <p>Consensus AI Evaluation System</p>
  </div>

  <!-- Judges Panel -->
  <div class="judges-panel" id="judgesPanel">
    <div class="loading">Loading judges</div>
  </div>

  <!-- Task Submission Panel -->
  <div class="task-panel">
    <h2>üìã Submit Task for Evaluation</h2>
    <form class="task-form" id="taskForm">
      <div class="form-group">
        <label for="taskType">Task Type:</label>
        <select id="taskType">
          <option value="code_review">Code Review</option>
          <option value="bug_analysis">Bug Analysis</option>
          <option value="optimization">Optimization Review</option>
          <option value="security_audit">Security Audit</option>
        </select>
      </div>

      <div class="form-group">
        <label for="taskContent">Code or Content:</label>
        <textarea id="taskContent" placeholder="Paste your code here..."></textarea>
      </div>

      <div class="form-group">
        <label for="taskContext">Context (optional):</label>
        <textarea id="taskContext" rows="3" placeholder="Additional context or requirements..."></textarea>
      </div>

      <button type="submit" id="submitBtn">üèõÔ∏è Convene Tribunal</button>
    </form>
  </div>

  <!-- Results Panel -->
  <div class="results-panel" id="resultsPanel">
    <h2>‚öñÔ∏è Tribunal Decision</h2>
    <div id="resultsContent"></div>
  </div>

  <!-- Statistics Panel -->
  <div class="stats-panel">
    <h2>üìä Tribunal Statistics</h2>
    <div class="stats-grid" id="statsGrid">
      <div class="loading">Loading statistics</div>
    </div>
  </div>

  <script src="/agents/multi-judge/tribunal.js"></script>
  <script src="/agents/multi-judge/disagreement-tracker.js"></script>
  <script>
    let tribunal;
    let disagreementTracker;

    // Initialize
    async function init() {
      tribunal = new Tribunal();
      disagreementTracker = new DisagreementTracker();
      disagreementTracker.load();

      // Wait for judges to load
      await new Promise(resolve => setTimeout(resolve, 1000));

      renderJudges();
      renderStats();
    }

    // Render judges panel
    function renderJudges() {
      const panel = document.getElementById('judgesPanel');
      const judges = Array.from(tribunal.judges.values());

      if (judges.length === 0) {
        panel.innerHTML = '<div class="loading">No judges configured</div>';
        return;
      }

      panel.innerHTML = judges.map(judge => `
        <div class="judge-card ${judge.status === 'offline' ? 'offline' : ''}">
          <div class="judge-header">
            <div class="judge-name">${judge.name}</div>
            <div class="judge-status ${judge.status}">${judge.status.toUpperCase()}</div>
          </div>
          <div class="judge-stats">
            <div class="stat-row">
              <span>Priority:</span>
              <span>${judge.priority}/10</span>
            </div>
            <div class="stat-row">
              <span>Total Votes:</span>
              <span>${judge.totalVotes}</span>
            </div>
            <div class="stat-row">
              <span>Agreements:</span>
              <span>${judge.agreements}</span>
            </div>
            <div class="stat-row">
              <span>Disagreements:</span>
              <span>${judge.disagreements}</span>
            </div>
            <div class="stat-row">
              <span>Agreement Rate:</span>
              <span>${judge.totalVotes > 0 ? Math.round((judge.agreements / judge.totalVotes) * 100) : 0}%</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Render statistics
    function renderStats() {
      const stats = tribunal.getStats();
      const disagreeStats = disagreementTracker.getStats();
      const grid = document.getElementById('statsGrid');

      grid.innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${stats.totalSessions}</div>
          <div class="stat-label">Total Sessions</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${disagreeStats.total}</div>
          <div class="stat-label">Disagreements</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${disagreeStats.bySeverity.HIGH || 0}</div>
          <div class="stat-label">High Severity</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${stats.judges.filter(j => j.status === 'online').length}</div>
          <div class="stat-label">Judges Online</div>
        </div>
      `;
    }

    // Handle form submission
    document.getElementById('taskForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const taskType = document.getElementById('taskType').value;
      const taskContent = document.getElementById('taskContent').value;
      const taskContext = document.getElementById('taskContext').value;

      if (!taskContent.trim()) {
        alert('Please provide code or content to evaluate');
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ Convening tribunal...';

      const resultsPanel = document.getElementById('resultsPanel');
      resultsPanel.classList.add('active');
      document.getElementById('resultsContent').innerHTML = '<div class="loading">Judges are deliberating</div>';

      try {
        const session = await tribunal.evaluate({
          type: taskType,
          content: taskContent,
          context: { note: taskContext }
        });

        // Log disagreement if applicable
        if (session.consensus.hasDisagreement) {
          disagreementTracker.log(session);
        }

        // Render results
        renderResults(session);

        // Update displays
        renderJudges();
        renderStats();

      } catch (error) {
        document.getElementById('resultsContent').innerHTML = `
          <div class="disagreement-warning">
            ‚ùå Error: ${error.message}
          </div>
        `;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üèõÔ∏è Convene Tribunal';
      }
    });

    // Render tribunal results
    function renderResults(session) {
      const verdictClass = getVerdictClass(session.consensus.verdict);
      const confidence = Math.round(session.consensus.confidence * 100);

      let html = `
        <div class="consensus-result">
          <div class="verdict ${verdictClass}">${session.consensus.verdict}</div>
          <div class="stat-row">
            <span>Confidence:</span>
            <span>${confidence}%</span>
          </div>
          <div class="confidence-bar">
            <div class="confidence-fill" style="width: ${confidence}%">${confidence}%</div>
          </div>
          <div class="stat-row">
            <span>Agreement Rate:</span>
            <span>${session.consensus.agreementRate}%</span>
          </div>
          <div class="stat-row">
            <span>Duration:</span>
            <span>${session.duration}ms</span>
          </div>
          ${session.consensus.unanimousDecision ? '<div style="color: #00ffe1; margin-top: 10px;">‚úì Unanimous Decision</div>' : ''}
        </div>
      `;

      if (session.consensus.hasDisagreement) {
        html += `
          <div class="disagreement-warning">
            ‚ö†Ô∏è Judges disagree on this evaluation. Human review may be recommended.
          </div>
        `;
      }

      html += '<div class="votes-list"><h3>Individual Votes:</h3>';

      for (const vote of session.votes) {
        const voteConfidence = Math.round(vote.vote.confidence * 100);
        html += `
          <div class="vote-card">
            <div class="vote-header">
              <div class="judge-name">${vote.judgeName}</div>
              <div class="vote-confidence">${voteConfidence}% confident</div>
            </div>
            <div class="vote-verdict ${getVerdictClass(vote.vote.verdict)}">${vote.vote.verdict}</div>
            <div style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">${vote.vote.reasoning.substring(0, 200)}...</div>
          </div>
        `;
      }

      html += '</div>';

      document.getElementById('resultsContent').innerHTML = html;
    }

    // Get CSS class for verdict
    function getVerdictClass(verdict) {
      const positive = ['APPROVE', 'EXCELLENT', 'GOOD', 'SECURE', 'NONE', 'LOW'];
      const critical = ['REJECT', 'CRITICAL', 'POOR'];

      if (positive.includes(verdict)) return 'positive';
      if (critical.includes(verdict)) return 'critical';
      return 'warning';
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
